import numpy as np #importing a module
from mbnpy import variable, cpm, network, inference #importing relevant code classes from MBNpy

#1 Define the variables (nodes). two states false/true
#At this stage the nodes are not connected in any way.

train = variable.Variable('TrainStrike', ['False','True']) #Variable Class inside the variable module, creates an objected called "train".
late = variable.Variable('NormanLate', ['False','True'])

#2 Define the cpm of the two variables from 1.
#cpm defined in two parts. C defined the variables/outcomes in the cpm, p defines the probabilities assigned to those variables/outcomes
# C has 2 states - has 2 rows, C has one variable Train late - has one column
# p must have columns that match C rows

cpm_train = cpm.Cpm(
		[train], no_child=1,
		C=np.array([[0], [1]], dtype=int),
		p=np.array([0.9, 0.1])
)


#[train] is the object created previously to which the CPM will be assigned.
#no_child is the number of child nodes assocaited with the CPM
#C is the states that can be taken
#np. is the module in which the array class is contained. 
#the array class takes arguments [O] and [1] along with data type integer definition 2 x 1 matrix
#p is the probability definition for the two states and takes values 0.9 and 0.1 -  1 x 2 matrix

#Next need to define the Child CPM of the NormanLate|TrainStrike
#Define C_child & p_child and then wrap into cpm
# C has two variables to consider and has two columns (train on strike, norman is late)
# C has 4 states FF, FT, TF, TT so has 4 rows

C_child=np.array([
				[0, 0], #False-False
				[0, 1],	#False-True
				[1, 0],	#True-False
				[1, 1], #True-True
				], dtype=int)

#Now to define the probabilities to go with the matrix
#C has 4 rows, p must have 4 columns. (1x 4)

p_child = np.array([0.9, 0.2, 0.1, 0.8])

#build the cpm_late from the C and p above. no_child=1, means that late is the child, everything after is a parent (train)

cpm_late = cpm.Cpm([late, train], no_child=1, C= C_child, p=p_child)

#Carry out inference
#use inference.variable_elim(cpms, var_elim, prod=True) method
#cpms - defines the condition probability matrices to be used
#var_elim - defines the variable to be eliminated TrainStrike (not interested in train strike true/false only interested in norman late.)
#prod=True - take the products of the matrices to calculate joint probability distribution before eliminating the train strike variable
# Collect CPMs for inference calls

marg_late = inference.variable_elim(cpms=[cpm_train, cpm_late], var_elim=['TrainStrike'], prod=True)
print(marg_late)

#Condition on norman being late
#Condition the child CPM - Insert evidence that Norman in late.
#inference.condition(cpms, cnd_vars, cnd_states)

Train_late = inference.condition(cpms=[cpm_late, cpm_train], cnd_vars=['NormanLate'], cnd_states=[1])


marg_Train_Late = inference.variable_elim(cpms=Train_late, var_elim=['NormanLate'], prod=True)
print(marg_Train_Late)
	




